{{ define "devices" }}
  {{ template "base" . }}
{{ end }}

{{ define "title" }}KWS Cloud | Devices{{ end }}

{{ define "content" }}
<div class="max-w-3xl mx-auto">
  <h2 class="text-3xl font-bold text-blue-400 mb-8 floating">Connected Devices</h2>

  <!-- Device Limit Notice -->
  {{ if ge (len .Devices) 3 }}
    <div class="bg-yellow-900 text-yellow-200 p-4 rounded-md mb-6 border border-yellow-700">
      You've reached the maximum device limit (3). Remove a device to add a new one.
    </div>
  {{ end }}

  <!-- Device List -->
  <div class="grid gap-6">
    {{ range .Devices }}
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6 flex justify-between items-center hover:shadow-md transition duration-300">
      <div>
        <p class="text-sm text-gray-500 mb-1">Allocated IP</p>
        <p class="text-lg font-mono text-blue-300">{{ .IP }}</p>

        <input type="hidden" value="{{ .PublicKey }}" name="public_key" />

        <p class="mt-3 text-sm">
          <span class="font-semibold text-gray-400">Status:</span>
          {{ if .Active }}
            <span class="text-green-400 font-semibold">Active</span>
          {{ else }}
            <span class="text-gray-500 font-semibold">Disconnected</span>
          {{ end }}
        </p>
      </div>

      <!-- Remove Button -->
      <form method="POST" action="/remove">
        <input type="hidden" name="device_id" value="{{ .ID }}" />
        <button class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium transition">
          Remove
        </button>
      </form>
    </div>
    {{ else }}
    <p class="text-gray-500 text-center">No devices connected yet.</p>
    {{ end }}
  </div>

  <!-- Add New Device -->
  {{ if lt (len .Devices) 3 }}
  <form class="mt-12 bg-gray-900 border border-gray-800 rounded-xl p-6 space-y-4" method="POST" action="/register">
    <h3 class="text-xl text-blue-300 font-semibold">Add New Device</h3>
    <div>
      <label class="block text-sm text-gray-300 mb-1">WireGuard Public Key</label>
      <input type="text" name="public_key" required
        class="w-full px-4 py-2 bg-gray-800 text-white border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition" />
    </div>
    <button type="submit"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition">
      Register Device
    </button>
  </form>
  {{ end }}
</div>
{{ end }}
